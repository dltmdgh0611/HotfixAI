# HotfixAI 백엔드 설정 가이드

## 🎉 완료된 작업

### 1. 데이터베이스 스키마 (Prisma)
- ✅ **User** 모델: 사용자 정보 (이메일, 이름, OAuth 프로바이더)
- ✅ **Project** 모델: 프로젝트 정보 (이름, FTP 설정, 파일 개수)
- ✅ **File** 모델: 파일 내용 (프로젝트별로 저장)

### 2. 인증 시스템
- ✅ 구글/네이버 OAuth 로그인
- ✅ 로그인 즉시 자동 회원가입
- ✅ Supabase Auth 연동

### 3. API 엔드포인트
- ✅ `GET /api/projects` - 프로젝트 목록 조회
- ✅ `POST /api/projects` - 프로젝트 생성
- ✅ `GET /api/projects/[id]` - 프로젝트 상세 조회
- ✅ `PATCH /api/projects/[id]` - 프로젝트 수정
- ✅ `DELETE /api/projects/[id]` - 프로젝트 삭제
- ✅ `POST /api/files/update` - 파일 업데이트 (AI 수정 시)

### 4. UI 업데이트
- ✅ start 페이지: 프로젝트 없을 때 → 큰 버튼 3개 (FTP/파일/폴더)
- ✅ start 페이지: 프로젝트 있을 때 → 카드 리스트 + 플러스 버튼
- ✅ 프로젝트 생성 모달: FTP/파일/폴더 선택
- ✅ Studio: AI 수정 시 자동으로 DB 저장

---

## 🚀 설정 방법

### 1단계: 환경 변수 설정

`apps/frontend/.env.local` 파일을 만들고 다음 내용을 추가하세요:

```env
# Supabase (OAuth 인증)
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJxxx...

# 데이터베이스 (Supabase Postgres)
DATABASE_URL=postgresql://postgres:[비밀번호]@[호스트]:6543/postgres?pgbouncer=true
DIRECT_URL=postgresql://postgres:[비밀번호]@[호스트]:5432/postgres

# OpenAI API
OPENAI_API_KEY=sk-xxx...
```

#### Supabase 설정 가져오기:
1. [Supabase Dashboard](https://supabase.com) 로그인
2. 프로젝트 선택 → **Settings** → **API**
   - `NEXT_PUBLIC_SUPABASE_URL` 복사
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY` 복사
3. **Settings** → **Database** → Connection string
   - Session mode (6543 포트) → `DATABASE_URL`
   - Direct connection (5432 포트) → `DIRECT_URL`

---

### 2단계: Prisma 마이그레이션

터미널에서 실행:

```bash
cd apps/frontend
npx prisma generate
npx prisma db push
```

성공 메시지가 나오면 데이터베이스 테이블이 생성된 것입니다.

---

### 3단계: OAuth 설정

#### 구글 OAuth 설정

1. [Google Cloud Console](https://console.cloud.google.com/) 접속
2. 프로젝트 생성
3. **APIs & Services** → **Credentials** → **OAuth 2.0 Client ID** 생성
4. **승인된 리디렉션 URI**에 추가:
   ```
   https://[your-project-ref].supabase.co/auth/v1/callback
   ```
5. Client ID와 Client Secret 복사
6. Supabase Dashboard → **Authentication** → **Providers** → **Google**
   - Enable 체크
   - Client ID와 Client Secret 입력
   - Save

#### 네이버 OAuth 설정 (선택사항)

1. [네이버 개발자 센터](https://developers.naver.com/apps/) 접속
2. 애플리케이션 등록
3. **서비스 환경**: PC 웹 선택
4. **Callback URL**:
   ```
   https://[your-project-ref].supabase.co/auth/v1/callback
   ```
5. Client ID와 Client Secret 복사

**참고**: 네이버는 Supabase에서 기본 지원하지 않아 커스텀 구현이 필요합니다. 먼저 구글로 테스트하세요.

---

### 4단계: 개발 서버 실행

```bash
cd apps/frontend
npm run dev
```

브라우저에서 http://localhost:3000/start 접속

---

## 📋 작동 흐름

### 1. 로그인
1. 사용자가 구글 로그인 클릭
2. OAuth 인증 완료
3. `/auth/callback` 라우트에서 자동 회원가입
4. `/start` 페이지로 리다이렉트

### 2. 프로젝트 생성
1. 프로젝트가 없으면: 큰 버튼 3개 표시 (FTP/파일/폴더)
2. FTP 연결 또는 파일 업로드
3. 프로젝트와 파일들이 DB에 저장
4. `/studio` 페이지로 이동

### 3. AI 수정
1. 사용자가 채팅에서 수정 요청
2. AI가 파일 수정
3. 수정된 파일이 자동으로 DB에 저장 (`/api/files/update`)
4. 프로젝트의 `updatedAt` 타임스탬프 갱신

### 4. 재방문
1. 사용자가 `/start` 접속
2. 저장된 프로젝트 카드 리스트 표시
3. 프로젝트 클릭 시 DB에서 파일 불러오기
4. 이어서 작업

---

## 🔍 테스트 체크리스트

- [ ] Prisma 마이그레이션 완료 (`npx prisma db push`)
- [ ] 구글 OAuth 로그인 작동
- [ ] 로그인 후 `/start` 페이지 이동
- [ ] FTP 연결로 프로젝트 생성
- [ ] 파일 업로드로 프로젝트 생성
- [ ] 프로젝트 목록에 생성된 프로젝트 표시
- [ ] 프로젝트 클릭 시 스튜디오 진입
- [ ] AI로 파일 수정
- [ ] 새로고침 후 수정사항 유지 (DB 저장 확인)

---

## 🛠️ 문제 해결

### Prisma 오류
```bash
npx prisma generate
npx prisma db push --force-reset  # 테이블을 완전히 재생성
```

### "prisma client is not generated" 오류
```bash
cd apps/frontend
npx prisma generate
npm run dev
```

### OAuth 리다이렉트 오류
- Supabase Dashboard에서 Redirect URL 확인
- 구글/네이버 콘솔에서 승인된 리디렉션 URI 확인
- URL이 정확히 일치하는지 확인 (끝에 슬래시 없어야 함)

### 데이터베이스 연결 오류
- Supabase 프로젝트가 활성 상태인지 확인
- `.env.local` 파일의 DATABASE_URL 확인
- 비밀번호에 특수문자가 있으면 URL 인코딩 필요

---

## 📁 주요 파일 구조

```
apps/frontend/
├── prisma/
│   └── schema.prisma          # 데이터베이스 스키마
├── src/
│   ├── app/
│   │   ├── api/
│   │   │   ├── projects/      # 프로젝트 API
│   │   │   └── files/update/  # 파일 업데이트 API
│   │   ├── auth/callback/     # OAuth 콜백
│   │   ├── start/             # 프로젝트 목록 페이지
│   │   └── studio/            # 스튜디오 페이지
│   └── lib/
│       └── prisma.ts          # Prisma 클라이언트
└── .env.local                 # 환경 변수 (생성 필요)
```

---

## 💡 추가 기능 아이디어

- [ ] 프로젝트 이름 수정
- [ ] 프로젝트 삭제 (휴지통)
- [ ] 프로젝트 검색/필터
- [ ] 팀 공유 기능
- [ ] 버전 히스토리 (파일 변경 이력)
- [ ] FTP 정보 암호화 저장

---

도움이 필요하면 언제든 질문하세요! 🚀


